<div class="row">
  <div class="col-md-12">
    <div class="card">
      <ngb-tabset [justify]="'fill'" [destroyOnHide]="false">
        <ngb-tab title="Details">
          <ng-template ngbTabContent>
            <div class="card-header">
              <h4 class="card-title">Currency Details</h4>
            </div>
            <div class="card-body">
              <div class="card-block">
                <div class="row">
                  <div class="col-md-4">
                    <div class="ucsb"> Name
                    </div>
                    <h4> {{currencyDetails.name}} </h4>
                  </div>
                  <div class="col-md-4">
                    <div class="ucsb"> Issuer
                    </div>
                    <h4>
                      <a class="hyperlink" (click)="openAccountDetails(currencyDetails.accountRS)">{{currencyDetails.accountRS}}</a>
                    </h4>
                  </div>
                  <div class="col-md-4">
                    <div class="ucsb"> Currency Id
                    </div>
                    <h4>
                      <a class="hyperlink" (click)="goToDetails(currencyDetails.currency)">{{currencyDetails.currency}}</a>
                    </h4>
                  </div>
                </div>
                <hr>
                <div class="row">
                  <div class="col-md-4">
                    <div class="ucsb"> Last Price
                    </div>
                    <h4>
                      {{lastTrade.rateTQT|shareToQuantity:currencyDetails.decimals|quantToAmount|numericalString}}
                      <small> XIN</small>
                    </h4>
                  </div>
                  <div class="col-md-4">
                    <div class="ucsb"> Exchanges
                    </div>
                    <h4> {{currencyDetails.numberOfExchanges}} </h4>
                  </div>
                  <div class="col-md-4">
                    <div class="ucsb"> Transfers
                    </div>
                    <h4> {{currencyDetails.numberOfTransfers}} </h4>
                  </div>
                </div>
                <hr>
                <div class="row">
                  <div class="col-md-4">
                    <div class="ucsb"> Supply
                    </div>
                    <h4>
                      {{currencyDetails.currentSupply|quantityToShare:currencyDetails.decimals|numericalString}}
                      <small> UNITS </small>
                    </h4>
                  </div>
                  <div class="col-md-4">
                    <div class="ucsb"> Ticker </div>
                    <h5>
                      <div> {{currencyDetails.code}} </div>
                    </h5>
                  </div>
                  <div class="col-md-4">
                    <div class="ucsb"> Details
                    </div>
                    <h4>
                      <a class="hyperlink" (click)="openCurrencyDetails(currencyDetails.code)"> Details </a>
                    </h4>
                  </div>
                </div>
              </div>
            </div>
          </ng-template>
        </ngb-tab>
        <ngb-tab title="Chart">
          <ng-template ngbTabContent>
            <div class="card-header">
              <h4 class="card-title">Currency Chart</h4>
            </div>
            <div class="card-body">
              <div class="card-block">
                <div id="currencyChartDiv" [hidden]="!lastTrade.rateTQT" [style.width.%]="100" [style.height.px]="500"></div>
                <div [hidden]="lastTrade.rateTQT">
                  <p class="text-center">No Data Available</p>
                </div>
              </div>
            </div>
          </ng-template>
        </ngb-tab>
      </ngb-tabset>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-md-12">
    <div class="card">
      <ngb-tabset [justify]="'fill'">
        <ngb-tab title="Exchange XIN for {{currencyDetails.code}}">
          <ng-template ngbTabContent>
            <!-- <div class="card-header">
              <h4 class="card-title">Exchange XIN for {{currencyDetails.code}}</h4>
            </div> -->
            <div class="card-body">
              <div class="card-block">
                <div class="form-actions">
                  <button type="button" class="btn mb-0 btn-default" (click)="openPublishExchangeOffer(currencyDetails.currency,currencyDetails.decimals,currencyDetails.code,currencyDetails.name)">
                    <i class="fa fa-plus"></i> Create Exchange Offer
                  </button>
                  <button type="button" class="btn mb-0 btn-default" (click)="openPublishExchangeBuyOffer(currencyDetails.currency,currencyDetails.decimals,currencyDetails.code,currencyDetails.name)">
                    <i class="fa fa-plus"></i> Create Buy Only
                  </button>
                  <button type="button" class="btn mb-0 btn-default" (click)="getSellOffers()">
                    <i class="fa fa-refresh"></i> Refresh
                  </button>
                  <span class="pull-right">
                    <strong> {{balanceTQT | amountTqt}} XIN </strong>
                  </span>
                </div>
                <hr>
                <form class="form" #f1="ngForm" novalidate>
                  <div class="form-body">
                    <div class="row">
                      <div class="col-sm-4">
                        <div class="form-group m-0">
                          <label>Price</label>
                          <div class="input-group m-0">
                            <input type="number" class="form-control" (input)="buyFormOnChange()" [(ngModel)]="buyOrderForm.price" name="price" #price="ngModel"
                              minValue="0" required>
                            <div class="input-group-append">
                              <span class="input-group-text">XIN</span>
                            </div>
                          </div>
                          <div *ngIf="price?.invalid && (price?.dirty || price?.touched)" class="input-error">
                            <div *ngIf="price?.errors.required">
                              Price is required
                            </div>
                            <div *ngIf="price?.errors.minValue && !price?.errors.required">
                              Price must be greater than equal to 0
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-sm-4">
                        <div class="form-group m-0">
                          <label>Quantity</label>
                          <div class="input-group m-0">
                            <input type="number" class="form-control" (input)="buyFormOnChange()" [(ngModel)]="buyOrderForm.quantity" name="quantity"
                              #quantity="ngModel" minValue="0" required>
                          </div>
                          <div *ngIf="quantity?.invalid && (quantity?.dirty || quantity?.touched)" class="input-error">
                            <div *ngIf="quantity?.errors.required">
                              Quantity is required
                            </div>
                            <div *ngIf="quantity?.errors.minValue && !quantity?.errors.required">
                              Quantity must be greater than equal to 0
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-sm-4">
                        <div class="form-group m-0">
                          <label>Total</label>
                          <div class="input-group m-0">
                            <input type="number" disabled class="form-control" [(ngModel)]="buyOrderForm.totalPrice" name="totalPrice" #totalPrice="ngModel"
                              minValue="0">
                            <div class="input-group-append">
                              <span class="input-group-text">XIN</span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="form-actions">
                      <button type="button" [disabled]="f1.invalid && !enableBuy" class="btn btn-raised mb-0 btn-success" (click)="placeOrderClick(buyOrderForm,'bid')">
                        Buy
                      </button>
                    </div>
                  </div>
                </form>
                <h4 class="card-title mb-3">Offers to Sell {{currencyDetails.code}}</h4>
                <ngx-datatable [rows]="sellOffersRows" [columnMode]="'standard'" [scrollbarH]="true" [footerHeight]="50" [rowHeight]="'auto'"
                  [externalPaging]="true" [count]="sellOffersPage.totalElements" [offset]="sellOffersPage.pageNumber" [limit]="sellOffersPage.size"
                  (page)='getSellOffers($event)' (autoRefresh)="getSellOffers()">
                  <ngx-datatable-column prop="rateTQT" name="Price per share">
                    <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                      {{value | rateTqtToPrice:decimals}}
                    </ng-template>
                  </ngx-datatable-column>
                  <ngx-datatable-column prop="supply" name="Quantity">
                    <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                      {{value | quantityToShare:decimals | numericalString}}
                    </ng-template>
                  </ngx-datatable-column>
                  <ngx-datatable-column prop="rateTQT" name="Sum">
                    <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                      {{value | rateTqtToSum:row}}
                    </ng-template>
                  </ngx-datatable-column>
                  <ngx-datatable-column prop="rateTQT" name="Actions">
                    <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                      <a class="btn btn-outline-danger">
                        <i class="fa fa-check-circle"></i>
                      </a>
                    </ng-template>
                  </ngx-datatable-column>
                </ngx-datatable>
                <hr>
                <p *ngIf="!hasSellOffers()">
                  <i class="fa fa-info-circle" aria-hidden="true"></i> &nbsp; No open sell offers. You cannot buy this currency now, but you could publish an exchange offer
                  instead, and wait for others to fill it.
                </p>
              </div>
            </div>
          </ng-template>
        </ngb-tab>
        <ngb-tab title="Exchange {{currencyDetails.code}} for XIN">
          <ng-template ngbTabContent>
            <!-- <div class="card-header">
              <h4 class="card-title">Sell</h4>
            </div> -->
            <div class="card-body">
              <div class="card-block">
                <div class="form-actions">
                  <button type="button" class="btn mb-0 btn-default" (click)="openPublishExchangeOffer(currencyDetails.currency,currencyDetails.decimals,currencyDetails.code)">
                    <i class="fa fa-plus"></i> Create Exchange Offer
                  </button>
                  <button type="button" class="btn mb-0 btn-default" (click)="openPublishExchangeSellOffer(currencyDetails.currency,currencyDetails.decimals,currencyDetails.code)">
                    <i class="fa fa-plus"></i> Create Sell Only
                  </button>
                  <button type="button" class="btn mb-0 btn-default" (click)="getBuyOffers()">
                    <i class="fa fa-refresh"></i> Refresh
                  </button>
                  <span class="pull-right">
                    <strong> {{unconfirmedUnits |quantityToShare:currencyDetails.decimals | amountTkn }} </strong>
                  </span>
                </div>
                <hr>
                <form class="form" #f2="ngForm" novalidate>
                  <div class="form-body">
                    <div class="row">
                      <div class="col-sm-4">
                        <div class="form-group m-0">
                          <label>Price</label>
                          <div class="input-group m-0">
                            <input type="number" class="form-control" (input)="sellFormOnChange()" [(ngModel)]="askOrderForm.price" name="price" #price="ngModel"
                              minValue="0" required>
                            <div class="input-group-append">
                              <span class="input-group-text">XIN</span>
                            </div>
                          </div>
                          <div *ngIf="price?.invalid && (price?.dirty || price?.touched)" class="input-error">
                            <div *ngIf="price?.errors.required">
                              Price is required
                            </div>
                            <div *ngIf="price?.errors.minValue && !price?.errors.required">
                              Price must be greater than equal to 0
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-sm-4">
                        <div class="form-group m-0">
                          <label>Quantity</label>
                          <div class="input-group m-0">
                            <input type="number" class="form-control" (input)="sellFormOnChange()" [(ngModel)]="askOrderForm.quantity" name="quantity"
                              #quantity="ngModel" minValue="0" required>
                          </div>
                          <div *ngIf="quantity?.invalid && (quantity?.dirty || quantity?.touched)" class="input-error">
                            <div *ngIf="quantity?.errors.required">
                              Quantity is required
                            </div>
                            <div *ngIf="quantity?.errors.minValue && !quantity?.errors.required">
                              Quantity must be greater than equal to 0
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-sm-4">
                        <div class="form-group m-0">
                          <label>Total</label>
                          <div class="input-group m-0">
                            <input type="number" disabled class="form-control" [(ngModel)]="askOrderForm.totalPrice" name="totalPrice" #totalPrice="ngModel"
                              minValue="0">
                            <div class="input-group-append">
                              <span class="input-group-text">XIN</span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="form-actions">
                      <button type="button" [disabled]="f2.invalid && !enableSell" class="btn btn-raised mb-0 btn-danger" (click)="placeOrderClick(askOrderForm,'ask')">
                        Sell
                      </button>
                    </div>
                  </div>
                </form>
                <h4 class="card-title mb-3">Offers to Buy {{currencyDetails.code}}</h4>
                <ngx-datatable [rows]="buyOffersRows" [columnMode]="'standard'" [scrollbarH]="true" [footerHeight]="50" [rowHeight]="'auto'"
                  [externalPaging]="true" [count]="buyOffersPage.totalElements" [offset]="buyOffersPage.pageNumber" [limit]="buyOffersPage.size"
                  (page)='getBuyOffers($event)' (autoRefresh)="getBuyOffers()">
                  <ngx-datatable-column prop="rateTQT" name="Price per share">
                    <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                      {{value | rateTqtToPrice:decimals}}
                    </ng-template>
                  </ngx-datatable-column>
                  <ngx-datatable-column prop="supply" name="Quantity">
                    <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                      {{value | quantityToShare:decimals | numericalString}}
                    </ng-template>
                  </ngx-datatable-column>
                  <ngx-datatable-column prop="rateTQT" name="Sum">
                    <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                      {{value | rateTqtToSum:row}}
                    </ng-template>
                  </ngx-datatable-column>
                  <ngx-datatable-column prop="rateTQT" name="Actions">
                    <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                      <a class="btn btn-outline-danger">
                        <i class="fa fa-check-circle"></i>
                      </a>
                    </ng-template>
                  </ngx-datatable-column>
                </ngx-datatable>
                <hr>
                <p *ngIf="!hasBuyOffers()">
                  <i class="fa fa-info-circle" aria-hidden="true"></i> &nbsp; No open buy offers. You cannot sell this currency now, but you could publish an exchange offer instead, and wait for others to fill it.
                </p>
              </div>
            </div>
          </ng-template>
        </ngb-tab>
      </ngb-tabset>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-md-12">
    <div class="card">
      <div class="card-header">
        <h4 class="card-title">Last Exchanges</h4>
      </div>
      <div class="card-body">
        <div class="card-block ml-3 mr-3">
          <ngx-datatable [rows]="exchangesRows" [columnMode]="'standard'" [scrollbarH]="true" [footerHeight]="50" [rowHeight]="'auto'"
            [externalPaging]="true" [count]="exchangesPage.totalElements" [offset]="exchangesPage.pageNumber" [limit]="exchangesPage.size"
            (page)='getDeskExchanges($event)' (autoRefresh)="getDeskExchanges()">
            <ngx-datatable-column prop="timestamp" name="Date">
              <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                {{value | timestamp}}
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column prop="units" name="Quantity">
              <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                {{value | unitsToQuantity:row.decimals}}
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column prop="rateTQT" name="Price">
              <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                {{value | rateTqtToPrice:row.decimals}}
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column prop="rateTQT" name="Sum">
              <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                {{value | rateTqtToSum:row}}
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column prop="buyerRS" name="Buyer">
              <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                <a class="hyperlink" (click)="openAccountDetails(value)">{{value}}</a>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column prop="sellerRS" name="Seller">
              <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                <a class="hyperlink" (click)="openAccountDetails(value)">{{value}}</a>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column prop="transaction" name="Actions">
              <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                <div class="btn-group-raised">
                <a class="btn btn-sm btn-grey btn-icon" (click)="goToDetails(value)" triggers="mouseenter:mouseleave" container="body" placement="top"
                  ngbPopover="Details">
                  <i class="fa fa-list-ul"></i>
                </a>
              </div>
              </ng-template>
            </ngx-datatable-column>
          </ngx-datatable>
        </div>
      </div>
    </div>
  </div>
</div>