<div class="row form-bordered">
    <div class="col-md-12">
        <div class="card">
            <div class="card-block main-card-block pb-0">
                <div class="border-bt">
                    <h2 class="main-title">Trade Desk</h2>
                    <app-breadcrumb></app-breadcrumb>
                </div>
                <div class="row mt-3">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Asset Details</h3>
                            </div>
                            <div class="card-body form-bordered">
                                <div class="card-block">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="ucsb"> Name </div>
                                            <h4> {{assetDetails.name}} </h4>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="ucsb"> Issuer </div>
                                            <h4>
                                                <a class="hyperlink" (click)="openAccountDetails(assetDetails.accountRS)">{{assetDetails.accountRS}}</a>
                                            </h4>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="ucsb"> Asset Id </div>
                                            <h4>
                                                <a class="hyperlink" (click)="goToDetails(assetDetails.asset)">{{assetDetails.asset}}</a>
                                            </h4>
                                        </div>

                                        <div class="col-md-6">
                                            <div class="ucsb"> Last Price </div>
                                            <h4>
                                                {{lastTrade.priceTQT|shareToQuantity:assetDetails.decimals|quantToAmount|numericalString}}
                                                <small> XIN</small>
                                            </h4>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="ucsb"> Trades </div>
                                            <h4> {{assetDetails.numberOfTrades}} </h4>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="ucsb"> Transfers </div>
                                            <h4> {{assetDetails.numberOfTransfers}} </h4>
                                        </div>

                                        <div class="col-md-6">
                                            <div class="ucsb"> Shareholders </div>
                                            <h4>
                                                {{assetDetails.numberOfAccounts}}
                                            </h4>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="ucsb"> Decimals</div>
                                            <h5>
                                                <div> {{assetDetails.decimals}}</div>
                                            </h5>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="ucsb"> Supply </div>
                                            <h4>
                                                <a class="hyperlink" (click)="openAssetDetails(assetDetails.asset)">
                                                    Details </a>
                                            </h4>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Asset Chart</h3>
                            </div>
                            <div class="card-body">
                                <div class="card-block">
                                    <div id="assetChartDiv" [hidden]="!lastTrade.priceTQT" [style.width.%]="100"
                                        [style.height.px]="300"></div>
                                    <div [hidden]="lastTrade.priceTQT">
                                        <p class="text-center">No Data Available</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class="mt-0 mb-0 ml-3 mr-3">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title border-0">BUY > {{assetDetails.name}}</h3>
                            </div>
                            <div class="card-body">
                                <div class="card-block">
                                    <div class="form-actions box-header box-header-green">
                                        <span class="btn-group-raised">
                                            <button type="button" class="btn mb-0 btn-icon btn-grey" (click)="getSellOrders()">
                                                <i class="fa fa-refresh"></i> </button>
                                        </span>
                                        <span class="pull-right"><strong> {{balanceTQT | amountTqt}} XIN </strong></span>
                                    </div>

                                    <form class="form inner-form mt-3" #f1="ngForm" novalidate>
                                        <div class="form-body">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="form-group m-0">
                                                        <label>Price</label>
                                                        <div class="input-group ml-0 mr-0 sign_in_inputs row form-border-bottom">
                                                            <div class="col-9">
                                                                <input type="number" class="pl-0 mb-0 pt-0 pb-0 form-control"
                                                                    (input)="buyFormOnChange()" [(ngModel)]="buyOrderForm.price"
                                                                    name="price" #price="ngModel" minValue="0" required>
                                                            </div>
                                                            <div class="col-3">

                                                                <span class="input-group-text text-yellow">XIN</span>

                                                            </div>
                                                        </div>
                                                        <div *ngIf="price?.invalid && (price?.dirty || price?.touched)"
                                                            class="input-error">
                                                            <div *ngIf="price?.errors.required">
                                                                Price is required
                                                            </div>
                                                            <div *ngIf="price?.errors.minValue && !price?.errors.required">
                                                                Price must be greater than equal to 0
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-group m-0">
                                                        <label>Quantity</label>
                                                        <div class="input-group ml-0 mr-0">
                                                            <input type="number" class="form-control" (input)="buyFormOnChange()"
                                                                [(ngModel)]="buyOrderForm.quantity" name="quantity"
                                                                #quantity="ngModel" minValue="0" required>
                                                        </div>
                                                        <div *ngIf="quantity?.invalid && (quantity?.dirty || quantity?.touched)"
                                                            class="input-error">
                                                            <div *ngIf="quantity?.errors.required">
                                                                Quantity is required
                                                            </div>
                                                            <div *ngIf="quantity?.errors.minValue && !quantity?.errors.required">
                                                                Quantity must be greater than equal to 0
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-group m-0">
                                                        <label>Total</label>
                                                        <div class="input-group ml-0 mr-0 sign_in_inputs row form-border-bottom">
                                                            <div class="col-9 pl-0">
                                                                <input type="text" disabled class="pl-0 mb-0 pt-0 pb-0 form-control"
                                                                    [(ngModel)]="buyOrderForm.totalPrice" name="totalPrice"
                                                                    #totalPrice="ngModel">
                                                            </div>
                                                            <div class="col-3">

                                                                <span class="input-group-text text-yellow">XIN</span>

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <button type="button" [disabled]="f1.invalid && !enableBuy" class="btn btn-raised mt-4 btn-gradient btn-green btn-create"
                                                        (click)="placeOrderClick(buyOrderForm,'bid')">
                                                        Buy
                                                    </button>
                                                </div>

                                            </div>
                                        </div>
                                    </form>
                                    <h3 class="card-title mb-3 mt-3">Sell Orders</h3>
                                    <ngx-datatable [rows]="sellOrdersRows" [columnMode]="'standard'" [scrollbarH]="true"
                                        [footerHeight]="50" [rowHeight]="'auto'" [externalPaging]="true" [count]="sellOrdersPage.totalElements"
                                        [offset]="sellOrdersPage.pageNumber" [limit]="sellOrdersPage.size" (page)='getSellOrders($event)'
                                        (autoRefresh)="getSellOrders()">
                                        <ngx-datatable-column prop="priceTQT" name="Price per share">
                                            <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                                                {{(value | pricePerShareSellOrder:decimals) * (value | quantToAmount) |
                                                numericalString}}
                                            </ng-template>
                                        </ngx-datatable-column>
                                        <ngx-datatable-column prop="quantityQNT" name="Quantity">
                                            <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                                                {{value | quantityToShare:decimals | numericalString}}
                                            </ng-template>
                                        </ngx-datatable-column>
                                        <ngx-datatable-column prop="priceTQT" name="Sum">
                                            <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                                                {{(value | quantToAmount) * row.quantityQNT | numericalString}}
                                            </ng-template>
                                        </ngx-datatable-column>
                                        <ngx-datatable-column prop="priceTQT" name="Actions">
                                            <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                                                <div class="btn-group-raised">
                                                    <a class="btn btn-sm btn-grey btn-icon" (click)="fillBuyOrderForm(row)">
                                                        <i class="fa fa-check-circle"></i>
                                                    </a>
                                                </div>
                                            </ng-template>
                                        </ngx-datatable-column>
                                    </ngx-datatable>

                                    <!-- <p *ngIf="!hasSellOffers()">
									   <i class="fa fa-info-circle" aria-hidden="true"></i> &nbsp; No open sell offers. You cannot buy this currency now, but you could publish an exchange offer
									   instead, and wait for others to fill it.
									 </p>-->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title border-0">Sell > {{assetDetails.name}}</h3>
                            </div>
                            <div class="card-body">
                                <div class="card-block">
                                    <div class="form-actions box-header  box-header-red">
                                        <span class="btn-group-raised">
                                            <button type="button" class="btn mb-0 btn-icon btn-grey" (click)="getBuyOrders()">
                                                <i class="fa fa-refresh"></i> </button>
                                        </span>
                                        <span class="pull-right"><strong> {{unconfirmedQuantityQNT
                                                |quantityToShare:assetDetails.decimals | amountTkn }} </strong><small>{{assetDetails.name}}</small></span>
                                    </div>

                                    <form class="form inner-form mt-3" #f2="ngForm" novalidate>
                                        <div class="form-body">
                                            <div class="row">
                                                <div class="col-sm-6">
                                                    <div class="form-group m-0">
                                                        <label>Price</label>
                                                        <div class="input-group ml-0 mr-0  sign_in_inputs row form-border-bottom">
                                                            <div class="col-9">
                                                                <input type="number" class="pl-0 mb-0 pt-0 pb-0 form-control"
                                                                    (input)="sellFormOnChange()" [(ngModel)]="askOrderForm.price"
                                                                    name="price" #price="ngModel" minValue="0" required>
                                                            </div>
                                                            <div class="col-3">

                                                                <span class="input-group-text text-yellow">XIN</span>

                                                            </div>

                                                        </div>
                                                        <div *ngIf="price?.invalid && (price?.dirty || price?.touched)"
                                                            class="input-error">
                                                            <div *ngIf="price?.errors.required">
                                                                Price is required
                                                            </div>
                                                            <div *ngIf="price?.errors.minValue && !price?.errors.required">
                                                                Price must be greater than equal to 0
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-6">
                                                    <div class="form-group m-0">
                                                        <label>Quantity</label>
                                                        <div class="input-group ml-0 mr-0 ">
                                                            <input type="number" class="form-control" (input)="sellFormOnChange()"
                                                                [(ngModel)]="askOrderForm.quantity" name="quantity"
                                                                #quantity="ngModel" minValue="0" required>
                                                        </div>
                                                        <div *ngIf="quantity?.invalid && (quantity?.dirty || quantity?.touched)"
                                                            class="input-error">
                                                            <div *ngIf="quantity?.errors.required">
                                                                Quantity is required
                                                            </div>
                                                            <div *ngIf="quantity?.errors.minValue && !quantity?.errors.required">
                                                                Quantity must be greater than equal to 0
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-group m-0">
                                                        <label>Total</label>
                                                        <div class="input-group ml-0 mr-0  sign_in_inputs row form-border-bottom">
                                                            <div class="col-9 pl-0">
                                                                <input type="text" disabled class="pl-0 mb-0 pt-0 pb-0 form-control"
                                                                    [(ngModel)]="askOrderForm.totalPrice" name="totalPrice"
                                                                    #totalPrice="ngModel">
                                                            </div>
                                                            <div class="col-3">

                                                                <span class="input-group-text text-yellow">XIN</span>

                                                            </div>
                                                        </div>

                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <button type="button" [disabled]="f2.invalid && !enableSell" class="btn btn-raised mt-4 btn-gradient btn-red btn-create"
                                                        (click)="placeOrderClick(askOrderForm,'ask')">
                                                        Sell
                                                    </button>
                                                </div>
                                            </div>

                                        </div>
                                    </form>
                                    <h3 class="card-title mb-3 mt-3">Buy Orders</h3>
                                    <ngx-datatable [rows]="buyOrdersRows" [columnMode]="'standard'" [scrollbarH]="true"
                                        [footerHeight]="50" [rowHeight]="'auto'" [externalPaging]="true" [count]="buyOrdersPage.totalElements"
                                        [offset]="buyOrdersPage.pageNumber" [limit]="buyOrdersPage.size" (page)='getBuyOrders($event)'
                                        (autoRefresh)="getBuyOrders()">
                                        <ngx-datatable-column prop="priceTQT" name="Price per share">
                                            <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                                                {{value | pricePerShareBuyOrder:decimals}}
                                            </ng-template>
                                        </ngx-datatable-column>
                                        <ngx-datatable-column prop="quantityQNT" name="Quantity">
                                            <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                                                {{value | quantityToShare:decimals | numericalString}}
                                            </ng-template>
                                        </ngx-datatable-column>
                                        <ngx-datatable-column prop="priceTQT" name="Sum">
                                            <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                                                {{((value | quantToAmount) | shareToQuantity: decimals) *
                                                (row.quantityQNT | quantityToShare : decimals) | numericalString }}
                                            </ng-template>
                                        </ngx-datatable-column>
                                        <ngx-datatable-column prop="priceTQT" name="Actions">
                                            <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                                                <div class="btn-group-raised">
                                                    <a class="btn btn-sm btn-grey btn-icon" (click)="fillSellOrderForm(row)">
                                                        <i class="fa fa-check-circle"></i>
                                                    </a>
                                                </div>
                                            </ng-template>
                                        </ngx-datatable-column>
                                    </ngx-datatable>

                                    <!--<p *ngIf="!hasBuyOffers()">
									  <i class="fa fa-info-circle" aria-hidden="true"></i> &nbsp; No open buy offers. You cannot sell this currency now, but you could publish an exchange offer instead, and wait for others to fill it.
									</p>-->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class="mt-0 mb-0 ml-3 mr-3">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Last Trades</h3>
                            </div>
                            <div class="card-body">
                                <div class="card-block">
                                    <ngx-datatable [rows]="tradesRows" [columnMode]="'standard'" [scrollbarH]="true"
                                        [footerHeight]="50" [rowHeight]="'auto'" [externalPaging]="true" [count]="tradesPage.totalElements"
                                        [offset]="tradesPage.pageNumber" [limit]="tradesPage.size" (page)='getAssetLastTrades($event)'
                                        (autoRefresh)="getAssetLastTrades()">
                                        <ngx-datatable-column prop="timestamp" name="Date">
                                            <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                                                {{value | timestamp}}
                                            </ng-template>
                                        </ngx-datatable-column>
                                        <ngx-datatable-column prop="quantityQNT" name="Quantity">
                                            <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                                                {{value | unitsToQuantity:row.decimals}}
                                            </ng-template>
                                        </ngx-datatable-column>
                                        <ngx-datatable-column prop="priceTQT" name="Price">
                                            <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                                                {{value | rateTqtToPrice:row.decimals}}
                                            </ng-template>
                                        </ngx-datatable-column>
                                        <ngx-datatable-column prop="priceTQT" name="Sum">
                                            <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                                                {{value | priceTqtToSum:row}}
                                            </ng-template>
                                        </ngx-datatable-column>
                                        <ngx-datatable-column prop="buyerRS" name="Buyer">
                                            <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                                                <a class="hyperlink" (click)="openAccountDetails(value)">{{value}}</a>
                                            </ng-template>
                                        </ngx-datatable-column>
                                        <ngx-datatable-column prop="sellerRS" name="Seller">
                                            <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                                                <a class="hyperlink" (click)="openAccountDetails(value)">{{value}}</a>
                                            </ng-template>
                                        </ngx-datatable-column>
                                        <ngx-datatable-column prop="tradeType" name="Type">
                                            <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                                                <div [innerHtml]="value | buySell"></div>
                                            </ng-template>
                                        </ngx-datatable-column>
                                        <ngx-datatable-column prop="transaction" name="Actions">
                                            <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                                                <div class="btn-group-raised">
                                                    <a class="btn btn-sm btn-grey btn-icon" (click)="goToDetails(row.askOrder)"
                                                        *ngIf="row.tradeType === 'buy'" triggers="mouseenter:mouseleave"
                                                        container="body" placement="top" ngbPopover="Details">
                                                        <i class="fa fa-list-ul"></i>
                                                    </a>
                                                    <a class="btn btn-sm btn-grey btn-icon" (click)="goToDetails(row.bidOrder)"
                                                        *ngIf="row.tradeType === 'sell'" triggers="mouseenter:mouseleave"
                                                        container="body" placement="top" ngbPopover="Details">
                                                        <i class="fa fa-list-ul"></i>
                                                    </a>
                                                </div>
                                            </ng-template>
                                        </ngx-datatable-column>
                                    </ngx-datatable>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>